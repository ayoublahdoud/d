<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Téléchargement automatique</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
</head>
<body>
    <button onclick="downloadAndClose()">Télécharger et Fermer</button>

    <script>
        async function getDownloadUrl() {
            try {
                const response = await fetch('https://api.github.com/repos/ayoublahdoud/f/zipball/main');
                const data = await response.json();
                const downloadUrl = data.zipball_url;
                return downloadUrl;
            } catch (error) {
                console.error('Erreur lors de la récupération du lien de téléchargement :', error);
                return null;
            }
        }

        async function downloadAndClose() {
            const downloadUrl = await getDownloadUrl();

            if (downloadUrl) {
                try {
                    const zipContent = await fetch(downloadUrl).then(response => response.blob());
                    const jszip = new JSZip();

                    // Ajouter le contenu du zip téléchargé à JSZip
                    await jszip.loadAsync(zipContent);

                    // Générer le fichier RAR
                    const rarContent = await jszip.generateAsync({ type: 'blob', mimeType: 'application/rar' });

                    // Créer un lien de téléchargement pour le fichier RAR
                    const downloadLink = document.createElement('a');
                    downloadLink.href = URL.createObjectURL(rarContent);
                    downloadLink.download = 'f.rar';

                    // Ajouter le lien à la page
                    document.body.appendChild(downloadLink);

                    // Cliquez sur le lien pour déclencher le téléchargement
                    downloadLink.click();

                    // Supprimez le lien de la page après le téléchargement
                    document.body.removeChild(downloadLink);

                    // Fermez la fenêtre après 3 secondes
                    setTimeout(function() {
                        window.close();
                    }, 3000);
                } catch (error) {
                    console.error('Erreur lors de la création du fichier RAR :', error);
                }
            }
        }
    </script>
</body>
</html>
